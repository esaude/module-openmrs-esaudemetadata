<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE databaseChangeLog [
        <!ELEMENT databaseChangeLog (changeSet)*>
        <!ATTLIST databaseChangeLog
                xmlns CDATA #REQUIRED
                xmlns:xsi CDATA #REQUIRED
                xsi:schemaLocation CDATA #REQUIRED>
        <!ELEMENT changeSet (preConditions|sql|comment|dropForeignKeyConstraint|addForeignKeyConstraint|sqlFile)*>
        <!ATTLIST changeSet
                author CDATA #REQUIRED
                id CDATA #REQUIRED>
        <!ELEMENT preConditions (dbms|sqlCheck|foreignKeyConstraintExists|tableExists)*>
        <!ATTLIST preConditions
                onError CDATA #IMPLIED
                onFail CDATA #REQUIRED>
        <!ELEMENT dbms (#PCDATA)>
        <!ATTLIST dbms
                type CDATA #REQUIRED>
        <!ELEMENT sqlCheck (#PCDATA)>
        <!ATTLIST sqlCheck
                expectedResult CDATA #REQUIRED>
        <!ELEMENT sql (#PCDATA)>
        <!ELEMENT foreignKeyConstraintExists (#PCDATA)>
        <!ATTLIST foreignKeyConstraintExists
                foreignKeyName CDATA #REQUIRED
                schemaName CDATA #IMPLIED>
        <!ELEMENT comment (#PCDATA)>
        <!ELEMENT dropForeignKeyConstraint (#PCDATA)>
        <!ATTLIST dropForeignKeyConstraint
                baseTableName CDATA #REQUIRED
                constraintName CDATA #REQUIRED>
        <!ELEMENT addForeignKeyConstraint (#PCDATA)>
        <!ATTLIST addForeignKeyConstraint
                baseColumnNames CDATA #REQUIRED
                baseTableName CDATA #REQUIRED
                constraintName CDATA #REQUIRED
                deferrable CDATA #REQUIRED
                initiallyDeferred CDATA #REQUIRED
                referencedColumnNames CDATA #REQUIRED
                referencedTableName CDATA #REQUIRED>
        <!ELEMENT sqlFile (#PCDATA)>
        <!ATTLIST sqlFile
                endDelimiter CDATA #IMPLIED
                path CDATA #REQUIRED>
        <!ELEMENT tableExists (#PCDATA)>
        <!ATTLIST tableExists
                schemaName CDATA #REQUIRED
                tableName CDATA #REQUIRED>
        ]>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
                  http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">
    <!--
        See http://www.liquibase.org/manual/home#available_database_refactorings
        for a list of supported elements and attributes
    -->
    <!--loading the initial dictionry for esaude-->
    <!--<changeSet id="esaude-dictionary-001" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
        </preConditions>
        <comment>Loading the dictionary for esaude........</comment>
        <sqlFile path="sql/dictionary/eSaudeConcepts24102016.sql" />
    </changeSet>-->

    <!--
        Ensure the selected default location actually exists. If it doesn't, set
        the value to the unknown location.
    -->
    <!--Setting the uncode of the database to utf-8 for openmrs
    -->
    <!--<changeSet id="esaude-metadata-database-unicode-001" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
        </preConditions>
        <comment>Changing the unicode of the openmrs database to utf-8</comment>
        <sql>
            ALTER DATABASE openmrs CHARACTER SET utf8 COLLATE utf8_unicode_ci;
        </sql>
    </changeSet>-->
    <changeSet id="esaude-metadata-1" author="psbrandt">
        <preConditions onFail="MARK_RAN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                select count(*) from location as l, global_property as gp where l.name=gp.property_value and gp.property='default_location';
            </sqlCheck>
        </preConditions>
        <sql>
            update global_property as gp, location as l set gp.property_value=l.name where l.location_id=1 and gp.property='default_location';
        </sql>
    </changeSet>

    <!--reporting_report_design foreign key fixes start here-->
    <changeSet id="esaude-metadata-2" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <foreignKeyConstraintExists foreignKeyName="reporting_report_design_ibfk_1" />
        </preConditions>
        <comment>Droping 'reporting_report_design_ibfk_1' and creating a new one  'changed_by for reporting_report_design'</comment>
        <dropForeignKeyConstraint baseTableName="reporting_report_design" constraintName="reporting_report_design_ibfk_1" />
        <addForeignKeyConstraint baseTableName="reporting_report_design" baseColumnNames="changed_by" constraintName="changed_by for reporting_report_design" referencedTableName="users"
                                 referencedColumnNames="user_id" deferrable="false" initiallyDeferred="false" />
    </changeSet>

    <changeSet id="esaude-metadata-3" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <foreignKeyConstraintExists foreignKeyName="reporting_report_design_ibfk_2" />
        </preConditions>
        <comment>Droping 'reporting_report_design_ibfk_2' and creating a new one  'creator for reporting_report_design'</comment>
        <dropForeignKeyConstraint baseTableName="reporting_report_design" constraintName="reporting_report_design_ibfk_2" />
        <addForeignKeyConstraint baseTableName="reporting_report_design" baseColumnNames="creator" constraintName="creator for reporting_report_design" referencedTableName="users"
                                 referencedColumnNames="user_id" deferrable="false" initiallyDeferred="false" />
    </changeSet>
    <changeSet id="esaude-metadata-4-dropping" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM liquibasechangelog WHERE id='esaude-metadata-4' AND author='ningosi';
            </sqlCheck>
        </preConditions>
        <comment>Dropping the liquibase change set that was erronoiusly done</comment>
        <sql>
            DELETE FROM liquibasechangelog WHERE id='esaude-metadata-4' AND author='ningosi';
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-4-correct" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <foreignKeyConstraintExists foreignKeyName="reporting_report_design_ibfk_3" />
        </preConditions>
        <comment>Droping 'reporting_report_design_ibfk_3' and creating a new one  'retired_by for reporting_report_design'</comment>
        <dropForeignKeyConstraint baseTableName="reporting_report_design" constraintName="reporting_report_design_ibfk_3" />
        <addForeignKeyConstraint baseTableName="reporting_report_design" baseColumnNames="report_definition_uuid" constraintName="report_definition_uuid for reporting_report_design" referencedTableName="serialized_object"
                                 referencedColumnNames="uuid" deferrable="false" initiallyDeferred="false" />
    </changeSet>

    <changeSet id="esaude-metadata-5" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <foreignKeyConstraintExists foreignKeyName="reporting_report_design_ibfk_4" />
        </preConditions>
        <comment>Droping 'reporting_report_design_ibfk_4' and creating a new one  'retired_by for reporting_report_design'</comment>
        <dropForeignKeyConstraint baseTableName="reporting_report_design" constraintName="reporting_report_design_ibfk_4" />
        <addForeignKeyConstraint baseTableName="reporting_report_design" baseColumnNames="retired_by" constraintName="retired_by for reporting_report_design" referencedTableName="users"
                                 referencedColumnNames="user_id" deferrable="false" initiallyDeferred="false" />
    </changeSet>

<!--clearing all the reporting framework changeset to force rebuild at reporting framework restart-->
    <changeSet id="esaude-metadata-6" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
        </preConditions>
        <comment>Clearing all reporting changesets for recreation</comment>
        <sql>
            DELETE FROM liquibasechangelog WHERE id LIKE 'reporting%';
        </sql>
    </changeSet>

    <!--reporting_report_design_resource foreing key naming fixes starts here-->
    <changeSet id="esaude-metadata-7" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <foreignKeyConstraintExists foreignKeyName="reporting_report_design_resource_ibfk_1" />
        </preConditions>
        <comment>Droping 'reporting_report_design_resource_ibfk_1' and creating a new one  'changed_by for reporting_report_design_resource'</comment>
        <dropForeignKeyConstraint baseTableName="reporting_report_design_resource" constraintName="reporting_report_design_resource_ibfk_1" />
        <addForeignKeyConstraint baseTableName="reporting_report_design_resource" baseColumnNames="changed_by" constraintName="changed_by for reporting_report_design_resource" referencedTableName="users"
                                 referencedColumnNames="user_id" deferrable="false" initiallyDeferred="false" />
    </changeSet>

    <changeSet id="esaude-metadata-8" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <foreignKeyConstraintExists foreignKeyName="reporting_report_design_resource_ibfk_2" />
        </preConditions>
        <comment>Droping 'reporting_report_design_resource_ibfk_2' and creating a new one  'creator for reporting_report_design_resource'</comment>
        <dropForeignKeyConstraint baseTableName="reporting_report_design_resource" constraintName="reporting_report_design_resource_ibfk_2" />
        <addForeignKeyConstraint baseTableName="reporting_report_design_resource" baseColumnNames="creator" constraintName="creator for reporting_report_design_resource" referencedTableName="users"
                                 referencedColumnNames="user_id" deferrable="false" initiallyDeferred="false" />
    </changeSet>

    <changeSet id="esaude-metadata-9" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <foreignKeyConstraintExists foreignKeyName="reporting_report_design_resource_ibfk_3" />
        </preConditions>
        <comment>Droping 'reporting_report_design_resource_ibfk_3' and creating a new one  'report_design_id for reporting_report_design_resource'</comment>
        <dropForeignKeyConstraint baseTableName="reporting_report_design_resource" constraintName="reporting_report_design_resource_ibfk_3" />
        <addForeignKeyConstraint baseTableName="reporting_report_design_resource" baseColumnNames="report_design_id" constraintName="report_design_id for reporting_report_design_resource" referencedTableName="reporting_report_design"
                                 referencedColumnNames="id" deferrable="false" initiallyDeferred="false" />
    </changeSet>

    <changeSet id="esaude-metadata-10" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <foreignKeyConstraintExists foreignKeyName="reporting_report_design_resource_ibfk_4" />
        </preConditions>
        <comment>Droping 'reporting_report_design_resource_ibfk_4' and creating a new one  'retired_by for reporting_report_design_resource'</comment>
        <dropForeignKeyConstraint baseTableName="reporting_report_design_resource" constraintName="reporting_report_design_resource_ibfk_4" />
        <addForeignKeyConstraint baseTableName="reporting_report_design_resource" baseColumnNames="retired_by" constraintName="retired_by for reporting_report_design_resource" referencedTableName="users"
                                 referencedColumnNames="user_id" deferrable="false" initiallyDeferred="false" />
    </changeSet>
    <!--reporting_report_processor foreing key naming fixes starts here-->
    <changeSet id="esaude-metadata-11" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <foreignKeyConstraintExists foreignKeyName="reporting_report_processor_ibfk_1" />
        </preConditions>
        <comment>Droping 'reporting_report_processor_ibfk_1' and creating a new one  'changed_by for reporting_report_processor'</comment>
        <dropForeignKeyConstraint baseTableName="reporting_report_processor" constraintName="reporting_report_processor_ibfk_1" />
        <addForeignKeyConstraint baseTableName="reporting_report_processor" baseColumnNames="changed_by" constraintName="changed_by for reporting_report_processor" referencedTableName="users"
                                 referencedColumnNames="user_id" deferrable="false" initiallyDeferred="false" />
    </changeSet>

    <changeSet id="esaude-metadata-12" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <foreignKeyConstraintExists foreignKeyName="reporting_report_processor_ibfk_2" />
        </preConditions>
        <comment>Droping 'reporting_report_processor_ibfk_2' and creating a new one  'creator for reporting_report_processor'</comment>
        <dropForeignKeyConstraint baseTableName="reporting_report_processor" constraintName="reporting_report_processor_ibfk_2" />
        <addForeignKeyConstraint baseTableName="reporting_report_processor" baseColumnNames="creator" constraintName="creator for reporting_report_processor" referencedTableName="users"
                                 referencedColumnNames="user_id" deferrable="false" initiallyDeferred="false" />
    </changeSet>

    <changeSet id="esaude-metadata-13" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <foreignKeyConstraintExists foreignKeyName="reporting_report_processor_ibfk_4" />
        </preConditions>
        <comment>Droping 'reporting_report_processor_ibfk_4' and creating a new one  'retired_by for reporting_report_processor'</comment>
        <dropForeignKeyConstraint baseTableName="reporting_report_processor" constraintName="reporting_report_processor_ibfk_4" />
        <addForeignKeyConstraint baseTableName="reporting_report_processor" baseColumnNames="creator" constraintName="retired_by for reporting_report_processor" referencedTableName="users"
                                 referencedColumnNames="user_id" deferrable="false" initiallyDeferred="false" />
    </changeSet>

    <changeSet id="esaude-metadata-14" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <foreignKeyConstraintExists foreignKeyName="reporting_report_processor_ibfk_3" />
        </preConditions>
        <comment>Droping 'reporting_report_processor_ibfk_3' and creating a new one  'reporting_report_processor_report_design'</comment>
        <dropForeignKeyConstraint baseTableName="reporting_report_processor" constraintName="reporting_report_processor_ibfk_3" />
        <addForeignKeyConstraint baseTableName="reporting_report_processor" baseColumnNames="report_design_id" constraintName="reporting_report_processor_report_design" referencedTableName="reporting_report_design"
                                 referencedColumnNames="id" deferrable="false" initiallyDeferred="false" />
    </changeSet>
    <!--reporting_report_request foreing key naming fixes starts here-->
    <changeSet id="esaude-metadata-15" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <foreignKeyConstraintExists foreignKeyName="reporting_report_request_ibfk_1" />
        </preConditions>
        <comment>Droping 'reporting_report_request_ibfk_1' and creating a new one  'requested_by for reporting_report_request'</comment>
        <dropForeignKeyConstraint baseTableName="reporting_report_request" constraintName="reporting_report_request_ibfk_1" />
        <addForeignKeyConstraint baseTableName="reporting_report_request" baseColumnNames="requested_by" constraintName="requested_by for reporting_report_request" referencedTableName="users"
                                 referencedColumnNames="user_id" deferrable="false" initiallyDeferred="false" />
    </changeSet>
    <!--serialized_object foreing key naming fixes starts here-->
    <changeSet id="esaude-metadata-16" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <foreignKeyConstraintExists foreignKeyName="serialized_object_ibfk_1" />
        </preConditions>
        <comment>Droping 'serialized_object_ibfk_1' and creating a new one  'serialized_object_changed_by'</comment>
        <dropForeignKeyConstraint baseTableName="serialized_object" constraintName="serialized_object_ibfk_1" />
        <addForeignKeyConstraint baseTableName="serialized_object" baseColumnNames="changed_by" constraintName="serialized_object_changed_by" referencedTableName="users"
                                 referencedColumnNames="user_id" deferrable="false" initiallyDeferred="false" />
    </changeSet>

    <changeSet id="esaude-metadata-17" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <foreignKeyConstraintExists foreignKeyName="serialized_object_ibfk_2" />
        </preConditions>
        <comment>Droping 'serialized_object_ibfk_2' and creating a new one  'serialized_object_creator'</comment>
        <dropForeignKeyConstraint baseTableName="serialized_object" constraintName="serialized_object_ibfk_2" />
        <addForeignKeyConstraint baseTableName="serialized_object" baseColumnNames="creator" constraintName="serialized_object_creator" referencedTableName="users"
                                 referencedColumnNames="user_id" deferrable="false" initiallyDeferred="false" />
    </changeSet>

    <changeSet id="esaude-metadata-18" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <foreignKeyConstraintExists foreignKeyName="serialized_object_ibfk_3" />
        </preConditions>
        <comment>Droping 'serialized_object_ibfk_3' and creating a new one  'serialized_object_retired_by'</comment>
        <dropForeignKeyConstraint baseTableName="serialized_object" constraintName="serialized_object_ibfk_3" />
        <addForeignKeyConstraint baseTableName="serialized_object" baseColumnNames="retired_by" constraintName="serialized_object_retired_by" referencedTableName="users"
                                 referencedColumnNames="user_id" deferrable="false" initiallyDeferred="false" />
    </changeSet>

    <changeSet id="esaude-metadata-19-correcting" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
        <sqlCheck expectedResult="1">
            SELECT COUNT(*) FROM liquibasechangelog WHERE id='esaude-metadata-19' AND author='ningosi';
        </sqlCheck>
        </preConditions>
        <comment>Dropping the liquibase change set that was erronoiusly done</comment>
        <sql>
            DELETE FROM liquibasechangelog WHERE id='esaude-metadata-19' AND author='ningosi';
        </sql>
    </changeSet>

    <!--supply default user for all metadata-->
    <changeSet id="esaude-metadata-19-corrected" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM person where uuid='aa81a280-57e9-11e6-bc5b-507b9dc4c741';
            </sqlCheck>
        </preConditions>
        <comment>Creating person object for user for the metadata creation</comment>
        <sql>
            INSERT INTO person(`gender`, `birthdate`, `birthdate_estimated`, `dead`, `death_date`, `cause_of_death`, `creator`, `date_created`, `changed_by`, `date_changed`, `voided`, `voided_by`, `date_voided`, `void_reason`, `uuid`)
            VALUES('M', '2000-12-01', 1, 0, NULL, NULL, 1, current_date, NULL, NULL, 0, NULL, NULL, NULL, 'aa81a280-57e9-11e6-bc5b-507b9dc4c741');
        </sql>
    </changeSet>
    
    <changeSet id="esaude-metadata-20" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM person_name where uuid='2a1b5f8a-57eb-11e6-9c63-507b9dc4c741';
            </sqlCheck>
        </preConditions>
        <comment>Creating person name and user objects</comment>
        <sqlFile path="sql/metadataUser.sql" />
    </changeSet>

    <changeSet id="esaude-metadata-21" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
        </preConditions>
        <comment>Granting relevant roles to the 'esaude.metadata' user</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO user_role(`user_id`,`role`) VALUES(@user_id, 'System Developer');

        </sql>
    </changeSet>

    <!--flags required for poc work-->
    <!--The precondition should check that the patient flags table exists, and that the flag does not already exist-->
    <changeSet id="esaude-metadata-22" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <tableExists tableName="patientflags_flag" schemaName="openmrs" />
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM patientflags_flag WHERE name='ELIGIBLES';
            </sqlCheck>
        </preConditions>
        <comment>Creating the 'eligibles' patient flag</comment>
        <sqlFile path="sql/eligibles.sql" />
    </changeSet>
    <!--Dropping the already existing Drug start date flag and provide the correct one-->
    <changeSet id="esaude-metadata-23-correcting" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM patientflags_flag WHERE name='DRUG START DATE';
            </sqlCheck>
        </preConditions>
        <sql>
            SET FOREIGN_KEY_CHECKS = 0;
            DELETE FROM patientflags_flag WHERE name='DRUG START DATE';
            DELETE FROM liquibasechangelog WHERE id="esaude-metadata-23";
            SET FOREIGN_KEY_CHECKS = 1;
        </sql>
    </changeSet>
    <changeSet id="esaude-metadata-23-corrected" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <tableExists tableName="patientflags_flag" schemaName="openmrs" />
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM patientflags_flag WHERE name='DRUG START DATE';
            </sqlCheck>
        </preConditions>
        <comment>Creating the 'DRUG START DATE' patient flag</comment>
        <sqlFile path="sql/drug_start_date.sql" />
    </changeSet>

    <changeSet id="esaude-metadata-24" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <tableExists tableName="patientflags_flag" schemaName="openmrs" />
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM patientflags_flag WHERE name='CTZ_PROPHILAXIS';
            </sqlCheck>
        </preConditions>
        <comment>Creating the 'CTZ_PROPHILAXIS' patient flag</comment>
        <sqlFile path="sql/ctz_prophilaxis.sql" />
    </changeSet>
    <changeSet id="esaude-metadata-25-correcting" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM patientflags_flag WHERE name='CD4 FIRST CONSULTATION';
            </sqlCheck>
        </preConditions>
        <sql>
            SET FOREIGN_KEY_CHECKS = 0;
            DELETE FROM patientflags_flag WHERE name='CD4 FIRST CONSULTATION';
            DELETE FROM liquibasechangelog WHERE id="esaude-metadata-25";
            SET FOREIGN_KEY_CHECKS = 1;
        </sql>
    </changeSet>
    <changeSet id="esaude-metadata-25-corrected" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <tableExists tableName="patientflags_flag" schemaName="openmrs" />
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM patientflags_flag WHERE name='CD4 FIRST CONSULTATION';
            </sqlCheck>
        </preConditions>
        <comment>Creating the 'CD4 FIRST CONSULTATION' patient flag</comment>
        <sqlFile path="sql/cd4_first_consultation.sql" />
    </changeSet>
    <changeSet id="esaude-metadata-26-correcting" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM patientflags_flag WHERE name='CD4 6 MONTHS LATER';
            </sqlCheck>
        </preConditions>
        <sql>
            SET FOREIGN_KEY_CHECKS = 0;
            DELETE FROM patientflags_flag WHERE name='CD4 6 MONTHS LATER';
            DELETE FROM liquibasechangelog WHERE id="esaude-metadata-26";
            SET FOREIGN_KEY_CHECKS = 1;
        </sql>
    </changeSet>
    <changeSet id="esaude-metadata-26-corrected" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <tableExists tableName="patientflags_flag" schemaName="openmrs" />
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM patientflags_flag WHERE name='CD4 6 MONTHS LATER';
            </sqlCheck>
        </preConditions>
        <comment>Creating the 'CD4 6 MONTHS LATER' patient flag</comment>
        <sqlFile path="sql/cd4_6_months_later.sql" />
    </changeSet>

    <!--fixing system id for the metadata user-->
    <changeSet id="esaude-metadata-27" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT count(*) FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            </sqlCheck>
        </preConditions>
        <comment>Adding a system Id for the metadata user</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            UPDATE users SET system_id='ESAUDE METADATA' WHERE user_id=@user_id;
        </sql>
    </changeSet>

    <!--updating form schemas-->
    <changeSet id="esaude-metadata-28" author="ningosi">
        <sqlFile path="sql/update_forms_updated-1.sql" />
    </changeSet>


    <!--strat of form field settings-->
    <changeSet id="esaude-metadata-38" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid='83cec426-ddce-4c01-a366-9a60bbcc371b';
            </sqlCheck>
        </preConditions>
        <comment>Updating form fileds for vitals</comment>
        <sql>
            SET FOREIGN_KEY_CHECKS = 0;
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES (37, 765, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL , @user_id, '2016-08-25 06:55:35', 250.00000, '83cec426-ddce-4c01-a366-9a60bbcc371b');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-39" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid='5d0d0957-bf98-4508-9499-3047b67a9c3a';
            </sqlCheck>
        </preConditions>
        <comment>Updating form fileds for vitals</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES (37, 397, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL , @user_id, '2016-08-25 06:55:35', 250.00000, '5d0d0957-bf98-4508-9499-3047b67a9c3a');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-40" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'b65ca6a2-0a62-4499-b32c-e5c1578f4dee';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis children</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 205, NULL, NULL, NULL, 3204, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-11 19:23:13', 1625.00000, 'b65ca6a2-0a62-4499-b32c-e5c1578f4dee');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-41" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'c803c131-b56a-4876-8511-0bffb1c1162c';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis children</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 776, NULL, NULL, NULL, 3204, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-11 19:22:39', 1687.50000, 'c803c131-b56a-4876-8511-0bffb1c1162c');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-42" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '39ce7671-574e-4448-90c8-d3e251d4af56';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis children</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 769, NULL, NULL, NULL, 3204, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-11 19:14:55', 1675.00000, '39ce7671-574e-4448-90c8-d3e251d4af56');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-43" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '8cfe4be4-f4a4-42aa-ab19-725d330138cf';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis children</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 781, NULL, NULL, NULL, 3204, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-11 19:14:07', 1875.00000, '8cfe4be4-f4a4-42aa-ab19-725d330138cf');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-44" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '3be36552-5a5f-4f89-9488-df8e3890e9b9';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis children</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 779, NULL, NULL, NULL, 3204, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-11 19:13:42', 1925.00000, '3be36552-5a5f-4f89-9488-df8e3890e9b9');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-45" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'a69d5cde-e92b-4ba3-8a6a-c123dfd8e100';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis children</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 775, NULL, NULL, NULL, 3204, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-11 19:09:59', 1432.81250, 'a69d5cde-e92b-4ba3-8a6a-c123dfd8e100');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-46" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'ed354e72-2f96-43a6-ab28-45c21bd34785';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis children</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 768, NULL, NULL, NULL, 3204, NULL, NULL ,0, NULL, NULL, @user_id, '2016-08-11 19:07:52', 1428.12500, 'ed354e72-2f96-43a6-ab28-45c21bd34785');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-47" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '3aafaae2-c619-404c-b9a1-82e621881b1d';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis children</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 770, NULL, NULL, NULL, 3204, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-11 19:07:34', 1418.75000, '3aafaae2-c619-404c-b9a1-82e621881b1d');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-48" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '54d3f623-da08-414b-8841-031f41da7a88';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis children</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 773, NULL, NULL, NULL, 3204, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-11 17:32:05', 1587.50000, '54d3f623-da08-414b-8841-031f41da7a88');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-49" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '8478aa22-8998-4c28-b1fc-f04efae5fae2';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis children</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 774, NULL, NULL, NULL, 3204, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-11 17:31:49', 1575.00000, '8478aa22-8998-4c28-b1fc-f04efae5fae2');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-50" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'c1dd8b69-1ce6-47f6-9c07-e38ce38f0762';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis children</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 772, NULL, NULL, NULL, 3204, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-11 17:30:29', 1443.75000, 'c1dd8b69-1ce6-47f6-9c07-e38ce38f0762');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-51" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '5911800b-bee2-4c96-b119-01d80faa8761';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis children</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 780, NULL, NULL, NULL, 3204, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-11 17:30:13', 1437.50000, '5911800b-bee2-4c96-b119-01d80faa8761');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-52" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '1d5ec357-0b4d-48d5-b5b5-89c1ade70e61';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis children</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 777, NULL, NULL, NULL, 3204, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-11 17:28:08', 2000.00000, '1d5ec357-0b4d-48d5-b5b5-89c1ade70e61');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-53" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'd88e821d-bae9-4bae-b6a8-b8c047fb9890';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis children</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 766, NULL, NULL, NULL, 3204, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-11 17:27:50', 1950.00000, 'd88e821d-bae9-4bae-b6a8-b8c047fb9890');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-54" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '67ef8b0f-5de1-4b70-add8-4510a2accaa9';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis children</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 759, NULL, NULL, NULL, 3204, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-11 17:27:09', 1900.00000, '67ef8b0f-5de1-4b70-add8-4510a2accaa9');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-55" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '6c0d2b75-b929-4beb-b1a7-5bb714d6f6d5';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis children</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 500, NULL, NULL, NULL, 3204, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-11 17:26:14', 1850.00000, '6c0d2b75-b929-4beb-b1a7-5bb714d6f6d5');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-56" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '86a29cf1-6fd2-4bae-a239-a282a5edd11b';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis children</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 767, NULL, NULL, NULL, 3204, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-11 17:25:47', 1800.00000, '86a29cf1-6fd2-4bae-a239-a282a5edd11b');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-57" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'c0d9974a-4a1c-4b95-97fc-4c39e658502f';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis children</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 778, NULL, NULL, NULL, 3204, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-11 17:24:51', 1750.00000, 'c0d9974a-4a1c-4b95-97fc-4c39e658502f');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-58" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '418a1f61-35ee-464a-b4f0-66240f18fc85';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis children</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 319, NULL, NULL, NULL, 3204, NULL, NULL, 0, NULL, NULL, @user_id, '2011-01-26 18:15:05', 1700.00000, '418a1f61-35ee-464a-b4f0-66240f18fc85');
        </sql>
    </changeSet>

    <!--start form fields for the adults-->

    <changeSet id="esaude-metadata-59" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'fce0e153-215d-422d-985b-d36a3fed687b';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis adults</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 775, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-03 15:11:36', 2171.87500, 'fce0e153-215d-422d-985b-d36a3fed687b');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-60" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'e6551ba8-7bb8-4b69-8f17-cca5048621b7';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis adults</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 768, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-03 15:11:13', 2168.75000, 'e6551ba8-7bb8-4b69-8f17-cca5048621b7');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-61" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '01b783f3-e972-411f-8d8b-980d8aad7f4e';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis adults</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 770, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-03 15:10:53', 2162.50000, '01b783f3-e972-411f-8d8b-980d8aad7f4e');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-62" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '3634395b-4802-4e42-aa48-8335baecf76e';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis adults</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 781, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-03 15:09:13', 2550.00000, '3634395b-4802-4e42-aa48-8335baecf76e');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-63" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'f63aff74-c5b6-49a5-b883-094100a137bb';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis adults</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 769, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-03 15:08:29', 2450.00000, 'f63aff74-c5b6-49a5-b883-094100a137bb');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-64" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'd6b742a0-e8a5-493f-8b7b-4f7e32464574';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis adults</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 776, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-03 15:08:15', 2400.00000, 'd6b742a0-e8a5-493f-8b7b-4f7e32464574');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-65" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '6d2fb060-e530-45ca-82ce-7b9cf2afda69';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis adults</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 779, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-03 15:07:07', 2300.00000, '6d2fb060-e530-45ca-82ce-7b9cf2afda69');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-66" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '95c5a7ad-c43e-4a0f-8886-ee3cba1b863d';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis adults</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 402, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-02 11:29:27', 2250.00000, '95c5a7ad-c43e-4a0f-8886-ee3cba1b863d');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-67" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '3d3f50c8-ae49-4f5d-a64a-c957e734662a';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis adults</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 397, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-08-02 11:28:34', 2175.00000, '3d3f50c8-ae49-4f5d-a64a-c957e734662a');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-68" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'fc046c9b-6399-4d43-a1b1-d46117985ef1';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis adults</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 773, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-07-29 13:28:10', 2200.00000, 'fc046c9b-6399-4d43-a1b1-d46117985ef1');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-69" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '5fc349f2-a694-4a0c-803e-ccbb5402bd53';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis adults</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 774, NULL ,NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-07-29 13:27:48', 2150.00000, '5fc349f2-a694-4a0c-803e-ccbb5402bd53');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-70" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '93302556-6113-4bf6-967f-ac2f266a35be';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis adults</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 772, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id,'2016-07-29 13:27:26',2100.00000,'93302556-6113-4bf6-967f-ac2f266a35be');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-71" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '2b71e477-ce1f-4563-b577-1dd6f98c3097';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis adults</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 780, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-07-29 13:27:08', 2050.00000, '2b71e477-ce1f-4563-b577-1dd6f98c3097');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-72" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '5a911892-b162-4569-89d9-9369fd2373db';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis adults</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 777, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-07-29 13:25:56', 2000.00000, '5a911892-b162-4569-89d9-9369fd2373db');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-73" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '2393db1e-6af3-42a2-ba64-6310b3081041';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis adults</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 766, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-07-29 13:25:35', 1950.00000, '2393db1e-6af3-42a2-ba64-6310b3081041');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-74" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '0fcf9f12-2f0c-462f-81ad-b9f0bc65bfea';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis adults</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 759, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-07-29 13:25:11', 1900.00000, '0fcf9f12-2f0c-462f-81ad-b9f0bc65bfea');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-75" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'a2fda180-923d-426b-999a-27053b239c2a';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis adults</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 500, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-07-29 13:24:34', 1850.00000, 'a2fda180-923d-426b-999a-27053b239c2a');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-76" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'd68d9fbe-d0db-4350-b717-5fd4112752c7';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis adults</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 767, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-07-29 13:23:19', 1800.00000, 'd68d9fbe-d0db-4350-b717-5fd4112752c7');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-77" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'c3fa62c3-61ef-4cc5-a46b-8d96a345f48c';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis adults</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 778, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL,@user_id, '2016-07-29 13:22:46', 1750.00000, 'c3fa62c3-61ef-4cc5-a46b-8d96a345f48c');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-78" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '824a6cdb-2a64-4b04-9589-fe84ea4168db';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagnosis adults</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 771, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-07-29 13:21:37', 1700.00000, '824a6cdb-2a64-4b04-9589-fe84ea4168db');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-79" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '1abdb9ec-acad-4a7c-820f-5de3642a02aa';
            </sqlCheck>
        </preConditions>
        <comment>Updating form fileds for vitals for children</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES (44, 765, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL , @user_id, '2016-08-25 06:55:35', 250.00000, '1abdb9ec-acad-4a7c-820f-5de3642a02aa');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-80" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '69ae6e37-586a-482c-bbff-02a7bfaacb5e';
            </sqlCheck>
        </preConditions>
        <comment>Updating form fileds for vitals for children</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES (44, 397, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL , @user_id, '2016-08-25 06:55:35', 250.00000, '69ae6e37-586a-482c-bbff-02a7bfaacb5e');
        SET FOREIGN_KEY_CHECKS = 1;
        </sql>
    </changeSet>
    <changeSet id="esaude-metadata-81-correcting" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM patientflags_flag WHERE name='VIRALOGICAL FAILURE';
            </sqlCheck>
        </preConditions>
        <sql>
            SET FOREIGN_KEY_CHECKS = 0;
            DELETE FROM patientflags_flag WHERE name='VIRALOGICAL FAILURE';
            DELETE FROM liquibasechangelog WHERE id="esaude-metadata-81";
            SET FOREIGN_KEY_CHECKS = 1;
        </sql>
    </changeSet>
    <changeSet id="esaude-metadata-81-corrected" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <tableExists tableName="patientflags_flag" schemaName="openmrs" />
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM patientflags_flag WHERE name='VIRALOGICAL FAILURE';
            </sqlCheck>
        </preConditions>
        <comment>Creating the 'VIRALOGICAL FAILURE' patient flag</comment>
        <sqlFile path="sql/alerts/viralogical_failure.sql" />
    </changeSet>

    <!--correcting the OBITOU concept in the pt locale-->
    <changeSet id="esaude-metadata-82" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM concept_name where concept_id=2027 and locale='pt';
            </sqlCheck>
        </preConditions>
        <comment>Droping concept id 2027 in pt locale to match the changes made in metadata server</comment>
        <sql>
            SET FOREIGN_KEY_CHECKS=0;
            DELETE FROM concept_name WHERE concept_id=2027 and locale='pt';
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

   <changeSet id="esaude-metadata-83" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM concept_name where concept_id=159 and locale='pt';
            </sqlCheck>
        </preConditions>
        <comment>Renaming concept 159 in the pt locale</comment>
        <sql>
            UPDATE concept_name SET name='OBITOU, DIAGNOSTICO' WHERE concept_id=159 AND locale='pt';
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-84" author="ningosi">
       <preConditions onFail="MARK_RAN" onError="WARN">
           <dbms type="mysql"/>
           <sqlCheck expectedResult="2">
               SELECT COUNT(*) FROM concept_name where name ='stillborn' and locale='en';
           </sqlCheck>
       </preConditions>
       <comment>Voiding concept 1819 in the en locale</comment>
       <sql>
           SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
           UPDATE concept_name SET voided=1, voided_by=@user_id, date_voided=current_date, void_reason='duplicate concept in locale en' WHERE concept_id=1819 AND locale='en' AND name ='stillborn';
       </sql>
   </changeSet>

   <changeSet id="esaude-metadata-85" author="ningosi">
       <preConditions onFail="MARK_RAN" onError="WARN">
           <dbms type="mysql"/>
           <sqlCheck expectedResult="1">
               SELECT COUNT(*) FROM concept_name where concept_id =924 and locale='en' and name='SULFADOXINE AND PYRIMETHAMINE';
           </sqlCheck>
       </preConditions>
       <comment>Voiding concept 924 in the en locale</comment>
       <sql>
           SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
           UPDATE concept SET retired=1, retired_by=@user_id, date_retired=current_date, retire_reason='duplicate concept in locale en' WHERE concept_id=924;
       </sql>
   </changeSet>

  <changeSet id="esaude-metadata-86" author="ningosi">
       <preConditions onFail="MARK_RAN" onError="WARN">
           <dbms type="mysql"/>
           <sqlCheck expectedResult="1">
               SELECT COUNT(*) FROM concept_name where concept_id =1883 and locale='en' and name='MULTIVITAMIN';
           </sqlCheck>
       </preConditions>
       <comment>Voiding concept 1883 in the en locale</comment>
       <sql>
           SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
           UPDATE concept_name SET voided=1, voided_by=@user_id, date_voided=current_date, void_reason='duplicate concept in locale en' WHERE concept_id=1883 AND locale='en' and name='MULTIVITAMIN';
       </sql>
   </changeSet>

   <changeSet id="esaude-metadata-87" author="ningosi">
       <preConditions onFail="MARK_RAN" onError="WARN">
           <dbms type="mysql"/>
           <sqlCheck expectedResult="1">
               SELECT COUNT(*) FROM concept_name where concept_id =1883 and locale='pt' and name='MULTIVITAMINA';
           </sqlCheck>
       </preConditions>
       <comment>Deleting concept 1883 in the pt locale from concept_name table</comment>
       <sql>
           SET FOREIGN_KEY_CHECKS=0;
           DELETE FROM concept_name WHERE concept_id=1883 AND locale='pt' and name='MULTIVITAMINA';
           SET FOREIGN_KEY_CHECKS=1;
       </sql>
   </changeSet>

   <changeSet id="esaude-metadata-88" author="ningosi">
       <preConditions onFail="MARK_RAN" onError="WARN">
           <dbms type="mysql"/>
           <sqlCheck expectedResult="1">
               SELECT COUNT(*) FROM concept_name where concept_id =1445 and locale='pt' and name='NENHUM';
           </sqlCheck>
       </preConditions>
       <comment>Deleting concept 1445 in the pt locale in the concept_name table</comment>
       <sql>
           SET FOREIGN_KEY_CHECKS=0;
           DELETE FROM  concept_name WHERE concept_id=1445 AND locale='pt' and name='NENHUM';
           SET FOREIGN_KEY_CHECKS=1;

       </sql>
   </changeSet>

   <changeSet id="esaude-metadata-89" author="ningosi">
       <preConditions onFail="MARK_RAN" onError="WARN">
           <dbms type="mysql"/>
           <sqlCheck expectedResult="1">
               SELECT COUNT(*) FROM concept_name where concept_id =891 and locale='pt' and name='tosse';
           </sqlCheck>
       </preConditions>
       <comment>Voiding concept 891 in the pt locale</comment>
       <sql>
           SET FOREIGN_KEY_CHECKS=0;
           DELETE FROM concept_name WHERE concept_id=891 AND locale='pt' and name='tosse';
           SET FOREIGN_KEY_CHECKS=1;
       </sql>
   </changeSet>

   <changeSet id="esaude-metadata-90" author="ningosi">
       <preConditions onFail="MARK_RAN" onError="WARN">
           <dbms type="mysql"/>
           <sqlCheck expectedResult="1">
               SELECT COUNT(*) FROM concept_name where concept_id =1841 and locale='pt' and name='TIPO DE ALEITAMENTO';
           </sqlCheck>
       </preConditions>
       <comment>Voiding concept 1841 in the pt locale</comment>
       <sql>
           SET FOREIGN_KEY_CHECKS=0;
           DELETE FROM concept_name WHERE concept_id=1841 AND locale='pt' and name='TIPO DE ALEITAMENTO';
           SET FOREIGN_KEY_CHECKS=1;
       </sql>
   </changeSet>

    <!--Field for who staging starts here-->
    <changeSet id="esaude-metadata-91" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'd7870f17-c91e-4e0f-b0db-eca7df93d128';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for who</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            SET FOREIGN_KEY_CHECKS=0;
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 784, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-07-13 23:53:13', 1700.00000, 'd7870f17-c91e-4e0f-b0db-eca7df93d128');
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-92" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '904c92e8-8f32-44a1-9126-d4173fc65ab6';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for who</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            SET FOREIGN_KEY_CHECKS=0;
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 785, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-07-14 00:53:38', 1750.00000, '904c92e8-8f32-44a1-9126-d4173fc65ab6');
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-93" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'bd03f34d-c438-4052-b83a-b530ee8c7c0a';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for who</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            SET FOREIGN_KEY_CHECKS=0;
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 783, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-07-14 01:02:45', 1800.00000, 'bd03f34d-c438-4052-b83a-b530ee8c7c0a');
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-94" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'b23769cb-f6c7-4fe0-b1b2-5187f283a40b';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for who</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            SET FOREIGN_KEY_CHECKS=0;
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 782, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-07-14 01:10:52', 1850.00000, 'b23769cb-f6c7-4fe0-b1b2-5187f283a40b');
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-95" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <tableExists tableName="patientflags_flag" schemaName="openmrs" />
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM patientflags_flag WHERE name='LOW HEMOGLOBIN LEVEL';
            </sqlCheck>
        </preConditions>
        <comment>Creating the 'LOW HEMOGLOBIN LEVEL' patient flag</comment>
        <sqlFile path="sql/alerts/hemoglobin_below_8.sql" />
    </changeSet>

<!--correcting the duplication of the Day(s) concept so as to appear as in metadata server-->
    <changeSet id="esaude-metadata-96" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="2">
                SELECT COUNT(*) FROM concept_name WHERE concept_id=6409 and locale='en';
            </sqlCheck>
        </preConditions>
        <sql>
            SET FOREIGN_KEY_CHECKS=0;
            DELETE FROM concept_name WHERE concept_id=6409 and locale='en';
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-97" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM concept WHERE uuid='9d6f51fb-10e8-11e5-9009-0242ac110012';
            </sqlCheck>
        </preConditions>
        <sql>
            SET FOREIGN_KEY_CHECKS=0;
            DELETE FROM concept WHERE uuid='9d6f51fb-10e8-11e5-9009-0242ac110012';
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-98" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM concept_name WHERE concept_id=1072 AND locale='en';
            </sqlCheck>
        </preConditions>
        <sql>
            UPDATE concept_name SET name='DAYS' WHERE concept_id=1072 AND locale='en';
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-99" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="2">
                SELECT COUNT(*) FROM concept_name WHERE concept_id=6427 AND locale='en';
            </sqlCheck>
        </preConditions>
        <sql>
            SET FOREIGN_KEY_CHECKS=0;
            DELETE FROM concept_name WHERE concept_id=6427 AND locale='en';
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-100" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM concept_name WHERE concept_id=1074 locale='en';
            </sqlCheck>
        </preConditions>
        <sql>
            UPDATE concept_name SET name='MONTHS' WHERE concept_id=1074 AND locale='en';
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-101" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="2">
                SELECT COUNT(*) FROM concept_name WHERE concept_id=6426 and locale='en';
            </sqlCheck>
        </preConditions>
        <sql>
            SET FOREIGN_KEY_CHECKS=0;
            DELETE FROM concept_name WHERE concept_id=6426 and locale='en';
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-102" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM concept_name WHERE concept_id=1073 AND locale='en';
            </sqlCheck>
        </preConditions>
        <sql>
            UPDATE concept_name SET name='WEEKS' WHERE concept_id=1073 AND locale='en';
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-103" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM concept WHERE uuid='9d96489b-10e8-11e5-9009-0242ac110012';
            </sqlCheck>
        </preConditions>
        <sql>
            SET FOREIGN_KEY_CHECKS=0;
            DELETE FROM concept WHERE uuid='9d96489b-10e8-11e5-9009-0242ac110012';
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

    <!--droppin the report_definition_uuid for reporting_report_design foreign key-->
    <changeSet id="esaude-metadata-104" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <foreignKeyConstraintExists foreignKeyName="report_definition_uuid for reporting_report_design" schemaName="openmrs" />
        </preConditions>
        <comment>Droping the `report_definition_uuid for reporting_report_design` foreign key that stops upgrade to `1.11.6+`</comment>
        <dropForeignKeyConstraint baseTableName="reporting_report_design" constraintName="report_definition_uuid for reporting_report_design" />
    </changeSet>

    <!--voiding concept_id 1534 in the concept name to avoid duplication of the concept name-->
    <changeSet id="esaude-metadata-105" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM concept_name where concept_id =1534 and locale='en' and name='ISONIAZID PROPYLAXIS';
            </sqlCheck>
        </preConditions>
        <comment>Voiding concept 1534 in the en locale in concept_name table</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            UPDATE concept_name SET voided=1, voided_by=@user_id, date_voided=current_date, void_reason='duplicate concept in locale en' WHERE concept_id=1534 AND locale='en' AND name='ISONIAZID PROPYLAXIS';
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-106" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM concept_name where concept_id =6122 and locale='en' and name='ISONIAZID PROPYLAXIS';
            </sqlCheck>
        </preConditions>
        <comment>Voiding concept 6122 in the en locale in concept_name table</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            UPDATE concept_name SET voided=1, voided_by=@user_id, date_voided=current_date, void_reason='duplicate concept in locale en' WHERE concept_id=6122 AND locale='en' AND name='ISONIAZID PROPYLAXIS';
        </sql>
    </changeSet>
    <changeSet id="esaude-metadata-107-correcting" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM patientflags_flag WHERE name='VIRAL LOAD DROPPED';
            </sqlCheck>
        </preConditions>
        <sql>
            SET FOREIGN_KEY_CHECKS = 0;
            DELETE FROM patientflags_flag WHERE name='VIRAL LOAD DROPPED';
            DELETE FROM liquibasechangelog WHERE id="esaude-metadata-107";
            SET FOREIGN_KEY_CHECKS = 1;
        </sql>
    </changeSet>
    <changeSet id="esaude-metadata-107-corrected" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <tableExists tableName="patientflags_flag" schemaName="openmrs" />
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM patientflags_flag WHERE name='VIRAL LOAD DROPPED';
            </sqlCheck>
        </preConditions>
        <comment>flag that shows viral load dropped > 50% from start to end of prophylaxis </comment>
        <sqlFile path="sql/alerts/viral_load_dropped.sql" />
    </changeSet>
    <!--load the address hierachy-->
       <changeSet id="esaude-metadata-108" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
        </preConditions>
        <comment>Populating table address_hierarchy_address_to_entry_map</comment>
        <sqlFile path="sql/address/openmrs_address_hierarchy_address_to_entry_map.sql" />
    </changeSet>

    <changeSet id="esaude-metadata-109" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
        </preConditions>
        <comment>Populating table address_hierarchy_entry</comment>
        <sqlFile path="sql/address/openmrs_address_hierarchy_entry.sql" />
    </changeSet>

    <changeSet id="esaude-metadata-110" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
        </preConditions>
        <comment>Populating table address_hierarchy_level</comment>
        <sqlFile path="sql/address/openmrs_address_hierarchy_level.sql" />
    </changeSet>
    <!--loading the dictionary from here-->
    <changeSet id="esaue-metadata-dictinary-001" author="nngosi">
        <preConditions onFail="MARK_RAN">
            <dbms type="mysql"/>
        </preConditions>
        <comment>Loading concept dictioary for eaude</comment>
        <sqlFile path="sql/dictionary/concepts14112016.sql" />
    </changeSet>
     <!--Removing Duplicate entry 'SCT' for key 'concept_source_unique_hl7_codes'-->
    <changeSet id="esaude-metadata-111" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM concept_reference_source WHERE name='SNOMED' AND hl7_code='SCT';
            </sqlCheck>
        </preConditions>
        <comment>Removing that so that it could be created a fresh</comment>
        <sql>
            SET FOREIGN_KEY_CHECKS=0;
            UPDATE concept_reference_source SET hl7_code='SCT1' WHERE name='SNOMED' AND hl7_code='SCT';
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

    <!--loading the form fields for ANAMNESE E EXAME FÍSICO - ADULTO-->
    <changeSet id="esaude-metadata-112" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '3bca43c2-6e30-4494-96d4-9890904c3247';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for who</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            SET FOREIGN_KEY_CHECKS=0;
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 787, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-10-10 06:03:09', 1525.00000, '3bca43c2-6e30-4494-96d4-9890904c3247');
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-113" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '73d19562-3c80-451f-b673-88b3ef5c2dff';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for who</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            SET FOREIGN_KEY_CHECKS=0;
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 786, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-10-10 06:03:09', 1350.00000, '73d19562-3c80-451f-b673-88b3ef5c2dff');
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

    <!--loading the form fields for ANAMNESE E EXAME FÍSICO - child-->
    <changeSet id="esaude-metadata-114" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'a39a036d-a8a9-4a19-ad66-b8fb124dfa76';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for who</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            SET FOREIGN_KEY_CHECKS=0;
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 787, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-10-10 06:03:09', 1228.12500, 'a39a036d-a8a9-4a19-ad66-b8fb124dfa76');
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-115" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '63325126-4f16-427c-a3e8-3061667da33d';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for who</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            SET FOREIGN_KEY_CHECKS=0;
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 786, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-10-10 06:03:09', 1231.25000, '63325126-4f16-427c-a3e8-3061667da33d');
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

    <!--Loading form fields for Diagnostico adult-->
    <changeSet id="esaude-metadata-120" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '32b61bab-156b-4d6e-a938-644287e69b81';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for who</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            SET FOREIGN_KEY_CHECKS=0;
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 22, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-10-10 06:03:09', 1350.00000, '32b61bab-156b-4d6e-a938-644287e69b81');
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-121" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'd516b911-032b-4ffc-9bc9-01978eb0ba41';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for who</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            SET FOREIGN_KEY_CHECKS=0;
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 22, NULL, NULL, NULL, 2731, NULL, NULL, 0, NULL, NULL, @user_id, '2016-10-10 06:03:09', 1350.00000, 'd516b911-032b-4ffc-9bc9-01978eb0ba41');
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

    <!--Loading form fields for Diagnostico child-->
    <changeSet id="esaude-metadata-118" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'c117109f-7eca-464c-9660-f2d17d4cdfd5';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagostico 1 for child</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            SET FOREIGN_KEY_CHECKS=0;
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 22, NULL, NULL, NULL, 3204, NULL, NULL, 0, NULL, NULL, @user_id, '2016-09-30 08:41:05', 1325.00000, 'c117109f-7eca-464c-9660-f2d17d4cdfd5');
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-119" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'd9e77865-6b9f-4130-a768-72b9df4a69ba';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for diagostico 2 for child</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            SET FOREIGN_KEY_CHECKS=0;
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 22, NULL, NULL, NULL, 3204, NULL, NULL, 0, NULL, NULL, @user_id, '2016-09-30 08:41:24', 925.00000, 'd9e77865-6b9f-4130-a768-72b9df4a69ba');
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

    <!--Importing the file that conatins the tables for cdc reporting-->
    <changeSet id="esaude-metadata-122cdc" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
        </preConditions>
        <comment>Adding the DATAEXPORTCD4CDCMOH_DB_SP_V02.sql file for reporting purposes</comment>
        <sqlFile path="sql/ddl/DATAEXPORTCD4CDCMOH_Only_TABLES.sql" />
    </changeSet>

    <changeSet id="esaude-metadata-122cdcsp" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
        </preConditions>
        <comment>Adding stored procedure needed</comment>
        <sqlFile endDelimiter="//" path="sql/ddl/DATAEXPORTCD4CDCMOH_Only_SP.sql" />
    </changeSet>

       <!--run the store procedure on the start of the EMM-->
    <changeSet id="esaude-metadata-124cdc" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
        </preConditions>
        <comment>Running the stroed procedure to populate the tables with data from openmrs</comment>
        <sql>
            SET SQL_SAFE_UPDATES = 0;
            CALL FillCD4CDCMISAU('2015-09-21','2016-09-20');
            SET SQL_SAFE_UPDATES = 1;
        </sql>
    </changeSet>

<!--add fields that are suppossed to be compulsory on the forms-->
    <!--social information for the adult-->
    <changeSet id="esaude-metadata-125" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM form_field WHERE uuid='e29f8ac6-1d5f-11e0-b929-000c29ad1d07';
            </sqlCheck>
        </preConditions>
        <comment>Making the nome of the social form compulsory</comment>

        <sql>
            SET SQL_SAFE_UPDATES = 0;
            UPDATE form_field SET required=1 WHERE uuid='e29f8ac6-1d5f-11e0-b929-000c29ad1d07';
            SET SQL_SAFE_UPDATES = 1;
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-126" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM form_field WHERE uuid='e2a0bb8a-1d5f-11e0-b929-000c29ad1d07';
            </sqlCheck>
        </preConditions>
        <comment>Making the Apelido of the social form compulsory</comment>

        <sql>
            SET SQL_SAFE_UPDATES = 0;
            UPDATE form_field SET required=1 WHERE uuid='e2a0bb8a-1d5f-11e0-b929-000c29ad1d07';
            SET SQL_SAFE_UPDATES = 1;
        </sql>
    </changeSet>

    <!--social information for the child-->
    <changeSet id="esaude-metadata-127" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM form_field WHERE uuid='e2a0d11a-1d5f-11e0-b929-000c29ad1d07';
            </sqlCheck>
        </preConditions>
        <comment>Making the nome of the social form compulsory for the children</comment>

        <sql>
            SET SQL_SAFE_UPDATES = 0;
            UPDATE form_field SET required=1 WHERE uuid='e2a0d11a-1d5f-11e0-b929-000c29ad1d07';
            SET SQL_SAFE_UPDATES = 1;
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-128" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM form_field WHERE uuid='e2a1c6a6-1d5f-11e0-b929-000c29ad1d07';
            </sqlCheck>
        </preConditions>
        <comment>Making the Apelido of the social form compulsory for the children</comment>

        <sql>
            SET SQL_SAFE_UPDATES = 0;
            UPDATE form_field SET required=1 WHERE uuid='e2a1c6a6-1d5f-11e0-b929-000c29ad1d07';
            SET SQL_SAFE_UPDATES = 1;
        </sql>
    </changeSet>

    <!--Adding compulsory address fields-->
    <changeSet id="esaude-metadata-129" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM address_hierarchy_level WHERE uuid='8e0a467f-7f7a-4f8d-abaf-65abd3d20ba1';
            </sqlCheck>
        </preConditions>
        <comment>Setting the country to be required</comment>
        <sql>
            SET SQL_SAFE_UPDATES = 0;
                UPDATE address_hierarchy_level SET required=1 WHERE uuid='8e0a467f-7f7a-4f8d-abaf-65abd3d20ba1';
            SET SQL_SAFE_UPDATES = 1;
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-130" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM address_hierarchy_level WHERE uuid='9ae2d905-d896-493f-94fa-ed679a4e2cdb';
            </sqlCheck>
        </preConditions>
        <comment>Setting the country to be required</comment>
        <sql>
            SET SQL_SAFE_UPDATES = 0;
            UPDATE address_hierarchy_level SET required=1 WHERE uuid='9ae2d905-d896-493f-94fa-ed679a4e2cdb';
            SET SQL_SAFE_UPDATES = 1;
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-131" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM address_hierarchy_level WHERE uuid='554a39f9-ac73-4e5f-ae32-fe2004d1e982';
            </sqlCheck>
        </preConditions>
        <comment>Setting the country to be required</comment>
        <sql>
            SET SQL_SAFE_UPDATES = 0;
            UPDATE address_hierarchy_level SET required=1 WHERE uuid='554a39f9-ac73-4e5f-ae32-fe2004d1e982';
            SET SQL_SAFE_UPDATES = 1;
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-132" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM address_hierarchy_level WHERE uuid='016bf7d9-440c-44d4-9652-4c5906c0931f';
            </sqlCheck>
        </preConditions>
        <comment>Setting the country to be required</comment>
        <sql>
            SET SQL_SAFE_UPDATES = 0;
            UPDATE address_hierarchy_level SET required=1 WHERE uuid='016bf7d9-440c-44d4-9652-4c5906c0931f';
            SET SQL_SAFE_UPDATES = 1;
        </sql>
    </changeSet>

    <!--Adding form fields for the WHO for the children-->
    <changeSet id="esaude-metadata-133" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '9ad5fe09-a35c-4400-b216-ee72b0e76523';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for who child for child - ESTADIO I</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            SET FOREIGN_KEY_CHECKS=0;
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 784, NULL, NULL, NULL, 3204, NULL, NULL, 0, NULL, NULL, @user_id, '2017-01-31 20:07:15', 2050.00000, '9ad5fe09-a35c-4400-b216-ee72b0e76523');
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-134" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '675e6753-e4a8-4919-939c-bcea25d76553';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for who child for child - ESTADIO II</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            SET FOREIGN_KEY_CHECKS=0;
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 785, NULL, NULL, NULL, 3204, NULL, NULL, 0, NULL, NULL, @user_id, '2017-01-31 20:07:58', 2100.00000, '675e6753-e4a8-4919-939c-bcea25d76553');
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-135" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = '35c00f28-5ce7-4917-b83e-a8f41a9b626e';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for who child for child - ESTADIO III</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            SET FOREIGN_KEY_CHECKS=0;
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 783, NULL, NULL, NULL, 3204, NULL, NULL, 0, NULL, NULL, @user_id, '2017-01-31 20:08:06', 2150.00000, '35c00f28-5ce7-4917-b83e-a8f41a9b626e');
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-136" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'b99023a4-1452-4f30-811f-6d96ad1028a8';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for who child for child - ESTADIO IV</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            SET FOREIGN_KEY_CHECKS=0;
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(44, 782, NULL, NULL, NULL, 3204, NULL, NULL, 0, NULL, NULL, @user_id, '2017-01-31 20:08:31', 2200.00000, 'b99023a4-1452-4f30-811f-6d96ad1028a8');
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

    <!--Loading the cd4 report-->
    <changeSet id="esaude-metadata-137" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM serialized_object WHERE uuid = 'ab960ae6-fe08-43d9-904d-2accc64126d8';
            </sqlCheck>
        </preConditions>
        <comment>Adding the cdcdatacd4 sql report</comment>
        <sqlFile path="sql/CDCDATACD4.sql" />
    </changeSet>

    <!--set the next date of appointment to be compulsory-->
    <!--for the child-->
    <changeSet id="esaude-metadata-138" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'e2ade81e-1d5f-11e0-b929-000c29ad1d07';
            </sqlCheck>
        </preConditions>
        <comment>Adding the next visit date to be compulsory for the child</comment>
        <sql>
            SET SQL_SAFE_UPDATES = 0;
            UPDATE form_field SET required=1 WHERE uuid='e2ade81e-1d5f-11e0-b929-000c29ad1d07';
            SET SQL_SAFE_UPDATES = 1;
        </sql>
    </changeSet>

    <!--for the adult-->

    <changeSet id="esaude-metadata-139" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'e2ade512-1d5f-11e0-b929-000c29ad1d07';
            </sqlCheck>
        </preConditions>
        <comment>Adding the next visit date to be compulsory for the adult</comment>
        <sql>
            SET SQL_SAFE_UPDATES = 0;
            UPDATE form_field SET required=1 WHERE uuid='e2ade512-1d5f-11e0-b929-000c29ad1d07';
            SET SQL_SAFE_UPDATES = 1;
        </sql>
    </changeSet>
    <!--changing the drug ingredient table to have the mappings to suite phamacy module-->
    <changeSet id="esaude-metadata-140-p" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
        </preConditions>
        <comment>Changing the concepts for the drug ingredients</comment>
        <sqlFile path="sql/pharmacy/order_frequency_update.sql" />
    </changeSet>

    <changeSet id="esaude-metadata-141-update" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM patientflags_flag WHERE uuid='a1d03d6c-8972-11e6-848d-507b9dc4c741';
            </sqlCheck>
        </preConditions>
        <comment>Updating the viral load drop criteria</comment>
        <sql>
            SET SQL_SAFE_UPDATES = 0;
            DELETE FROM patientflags_flag WHERE uuid='a1d03d6c-8972-11e6-848d-507b9dc4c741';
            SET SQL_SAFE_UPDATES = 1;
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-142" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM patientflags_flag WHERE uuid='a1d03d6c-8972-11e6-848d-507b9dc4c741';
            </sqlCheck>
        </preConditions>
        <comment>Updating the viral load drop criteria</comment>
        <sqlFile path="sql/alerts/viral_load_dropped_update.sql" />
    </changeSet>

    <changeSet id="esaude-metadata-143" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <foreignKeyConstraintExists foreignKeyName="report_definition_id for reporting_report_design" />
        </preConditions>
        <comment>Droping 'report_definition_id for reporting_report_design'</comment>
        <dropForeignKeyConstraint baseTableName="reporting_report_design" constraintName="report_definition_id for reporting_report_design" />
    </changeSet>
    <changeSet id="esaude-metadata-revert-reports" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM liquibasechangelog WHERE id="esaude-metadata-144";
            </sqlCheck>
        </preConditions>
        <comment>Reverting the report schema to original to maintain 1.9.2</comment>
        <sql>
            DELETE FROM liquibasechangelog WHERE id="esaude-metadata-144";
        </sql>
    </changeSet>
    
    <changeSet id="esaude-metadata-145" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
        </preConditions>
        <comment>Correcting velocity errors after upgrade to 1.11.5</comment>
        <sqlFile path="sql/correctVelocityError.sql" />
    </changeSet>
    <changeSet id="esaude-metadata-147" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
        </preConditions>
        <comment>Retiring drugs that have a null drug form</comment>
        <sql>
            SET SQL_SAFE_UPDATES = 0;
            SET FOREIGN_KEY_CHECKS = 0;
            UPDATE drug SET retired=1 WHERE dosage_form IS NULL;
            SET SQL_SAFE_UPDATES = 1;
            SET FOREIGN_KEY_CHECKS = 1;
        </sql>
    </changeSet>
    <changeSet id="esaude-metadata-148" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
        </preConditions>
        <comment>Creating phm_drug_items table </comment>
        <sqlFile path="sql/ddl/phm_drug_items.sql" />
    </changeSet>

    <changeSet id="esaude-metadata-149" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <tableExists tableName="phm_drug_items" schemaName="openmrs" />
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM phm_drug_items;
            </sqlCheck>
        </preConditions>
        <comment>Insert drugItem data provided by SIGLUS</comment>
        <sqlFile path="sql/pharmacy/insert_drug_item.sql" />
    </changeSet>

    <changeSet id="esaude-metadata-150" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
        </preConditions>
        <comment>Creating phm_drug_regime table </comment>
        <sqlFile path="sql/ddl/phm_drug_regime.sql" />
    </changeSet>

    <changeSet id="esaude-metadata-151" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <tableExists tableName="phm_drug_regime" schemaName="openmrs" />
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM phm_drug_regime;
            </sqlCheck>
        </preConditions>
        <comment>Inserting DrugRegime data mappings</comment>
        <sqlFile path="sql/pharmacy/insert_drug_regime_mapping.sql" />
    </changeSet>

    <changeSet id="esaude-metadata-152" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
        </preConditions>
        <comment>Creating phm_prescription_dispensation table </comment>
        <sqlFile path="sql/ddl/phm_prescription_dispensation.sql" />
    </changeSet>

    <changeSet id="esaude-metadata-153" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
        </preConditions>
        <comment>Modify the report_definition_uuid column to 38 characters</comment>
        <sql>
            SET FOREIGN_KEY_CHECKS = 0;
            alter table reporting_report_design modify report_definition_uuid char(38) not null;
            SET FOREIGN_KEY_CHECKS = 1;
        </sql>
    </changeSet>
    <changeSet id="esaude-metadata-154gpl" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
        </preConditions>
        <comment>Changing cause of death global property from using concept_id to concept_uuid</comment>
        <sql>
            SET FOREIGN_KEY_CHECKS = 0;
            UPDATE global_property SET property_value="e1e22b84-1d5f-11e0-b929-000c29ad1d07" WHERE property="concept.causeOfDeath";
            SET FOREIGN_KEY_CHECKS = 1;
        </sql>
    </changeSet>
    <!--Setting up the compulsory fields for vitals-->
    <changeSet id="esaude-metadata-form-fields-vitals-1" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
        </preConditions>
        <sql>
            SET FOREIGN_KEY_CHECKS = 0;
                UPDATE form_field SET required="1" WHERE field_id IN(282,20,26,283,384,402,397) AND form_id IN(37,44);
            SET FOREIGN_KEY_CHECKS = 1;
        </sql>
    </changeSet>

    <!-- Remove roles that are no longer needed -->
    <changeSet id="esaude-metadata-155" author="ynurmahomed">
        <sql>
            DELETE FROM role_role
            WHERE child_role IN ('Admin-Role', 'Consultation-Observation', 'InPatient-Patient-Movement', 'Registration-Additional',
            'Orders-Role', 'Clinical-Read-Only', 'Consultation-Disposition', 'Registration-Visit-Action', 'Registration-Read',
            'Clinical:ReadOnly', 'Clinical:FullAccess', 'Registration', 'Consultation-Treatment', 'Patient-Documents-Upload',
            'Privilege Level: Full', 'Consultation-Save', 'Consultation-Diagnosis', 'Registration-Write', 'Consultation-Orders',
            'InPatient-Read');

            DELETE FROM user_role
            WHERE role IN ('Admin-Role', 'Consultation-Observation', 'InPatient-Patient-Movement', 'Registration-Additional',
            'Orders-Role', 'Clinical-Read-Only', 'Consultation-Disposition', 'Registration-Visit-Action', 'Registration-Read',
            'Clinical:ReadOnly', 'Clinical:FullAccess', 'Registration', 'Consultation-Treatment', 'Patient-Documents-Upload',
            'Privilege Level: Full', 'Consultation-Save', 'Consultation-Diagnosis', 'Registration-Write', 'Consultation-Orders',
            'InPatient-Read');

            DELETE FROM role_privilege
            WHERE role IN ('Admin-Role', 'Consultation-Observation', 'InPatient-Patient-Movement', 'Registration-Additional',
            'Orders-Role', 'Clinical-Read-Only', 'Consultation-Disposition', 'Registration-Visit-Action', 'Registration-Read',
            'Clinical:ReadOnly', 'Clinical:FullAccess', 'Registration', 'Consultation-Treatment', 'Patient-Documents-Upload',
            'Privilege Level: Full', 'Consultation-Save', 'Consultation-Diagnosis', 'Registration-Write', 'Consultation-Orders',
            'InPatient-Read');

            DELETE FROM role
            WHERE role IN ('Admin-Role', 'Consultation-Observation', 'InPatient-Patient-Movement', 'Registration-Additional',
            'Orders-Role', 'Clinical-Read-Only', 'Consultation-Disposition', 'Registration-Visit-Action', 'Registration-Read',
            'Clinical:ReadOnly', 'Clinical:FullAccess', 'Registration', 'Consultation-Treatment', 'Patient-Documents-Upload',
            'Privilege Level: Full', 'Consultation-Save', 'Consultation-Diagnosis', 'Registration-Write', 'Consultation-Orders',
            'InPatient-Read');
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-280220181520" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
        </preConditions>
        <comment>Changing data type of (20687,20686,20685,20682) from Text(3) to Coded(2)</comment>
        <sql>
            SET FOREIGN_KEY_CHECKS = 0;
            UPDATE concept SET datatype_id = 2 WHERE concept_id in(20687,20686,20685,20682);
            SET FOREIGN_KEY_CHECKS = 1;
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-080320181103" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'ab76b422-c6fa-4e51-b7b7-104611ead4da';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for pregnancy form fields</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            SET FOREIGN_KEY_CHECKS=0;
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 348, NULL, NULL, NULL, 2731, NULL, NULL, 0, 1, '2018-03-01 09:34:44', @user_id, '2018-03-01 09:34:44', 2600.00000, 'ab76b422-c6fa-4e51-b7b7-104611ead4da');
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-080320181119" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM form_field WHERE uuid = 'e91bbcba-089e-4368-902e-b0bfe84948fb';
            </sqlCheck>
        </preConditions>
        <comment>Adding form fields for pregnancy form fields</comment>
        <sql>
            SELECT user_id INTO @user_id FROM users where uuid='f9a19c60-57eb-11e6-a798-507b9dc4c741';
            SET FOREIGN_KEY_CHECKS=0;
            INSERT INTO form_field(`form_id`,`field_id`,`field_number`,`field_part`,`page_number`,`parent_form_field`,`min_occurs`,`max_occurs`,`required`,`changed_by`, `date_changed`,`creator`,`date_created`,`sort_weight`,`uuid`)
            VALUES(37, 248, NULL, NULL, NULL, 2731, NULL, NULL, 0, 1, '2018-03-01 09:34:49', @user_id, '2018-03-01 09:34:29', 2650.00000, 'e91bbcba-089e-4368-902e-b0bfe84948fb');
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>
    <changeSet id="esaude-metadata-130320181420" author="ningosi">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM global_property WHERE property='default_locale';
            </sqlCheck>
        </preConditions>
        <comment>Setting the default locale to pt</comment>
        <sql>
            SET FOREIGN_KEY_CHECKS=0;
            UPDATE global_property SET property_value='pt' WHERE property='default_locale';
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

    <changeSet id="esaude-metadata-030420181500" author="edrisse">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <dbms type="mysql"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM global_property WHERE property='default_locale';
            </sqlCheck>
        </preConditions>
        <comment>Adding form field for occupations as list on POC</comment>
        <sqlFile path="sql/social/insert-poc-occupation-field.sql" />
    </changeSet>

</databaseChangeLog>
